<!doctype html>
<html lang="ja">

<head>
    <!--
    ================================================================================
    Toy Derby: Grand Prix - „É°„Ç§„É≥ HTML

    „Åì„ÅÆ„Éï„Ç°„Ç§„É´„ÅØ„Ç≤„Éº„É†„ÅÆ„Åô„Åπ„Å¶„ÅÆÊßãÈÄ†„ÄÅ„Çπ„Çø„Ç§„É´„ÄÅ„É≠„Ç∏„ÉÉ„ÇØ„ÇíÂê´„Çì„Åß„ÅÑ„Åæ„Åô„ÄÇ
    Three.js„Çí‰ΩøÁî®„Åó„Åü3DÊèèÁîª„Å®„ÄÅHTML/CSS„Å´„Çà„ÇãUI„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶„ÅÑ„Åæ„Åô„ÄÇ
    ================================================================================
    -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Toy Derby: Grand Prix</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=Orbitron:wght@500;700;900&family=Zen+Kaku+Gothic+New:wght@500;700;900&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="css/style.css">
    <script>
        window.onerror = function (msg, url, line, col, error) {
            const l = document.getElementById("loader");
            if (l) {
                l.innerHTML += `<br><div style="color:red;font-weight:bold;text-align:left;font-size:12px;margin-top:10px;">ERROR: ${msg}<br>at ${line}:${col}</div>`;
                const bar = document.getElementById("progress-bar");
                if (bar) bar.style.backgroundColor = "red";
            }
        };

        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Zen Kaku Gothic New"', "sans-serif"],
                        display: ['"Orbitron"', "sans-serif"],
                        tech: ['"Chakra Petch"', "sans-serif"],
                    },
                    colors: {
                        gold: {
                            400: "#FBBF24",
                            500: "#F59E0B",
                            600: "#D97706",
                            glow: "#FFD700",
                        },
                        glass: {
                            light: "rgba(255, 255, 255, 0.1)",
                            dark: "rgba(0, 0, 0, 0.6)",
                            border: "rgba(255, 255, 255, 0.2)",
                        },
                    },
                },
            },
        };
    </script>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loader">
        <div class="text-3xl font-bold mb-2">Toy Derby GP</div>
        <div class="text-sm text-gray-400">Building Racecourse...</div>
        <div class="loading-bar">
            <div class="loading-progress" id="progress-bar"></div>
        </div>
    </div>

    <!-- UI Overlay -->
    <div id="game-ui">
        <!-- Sound Toggle -->
        <div id="sound-toggle" onclick="toggleMute()">üîä</div>

        <!-- Countdown Overlay -->
        <div id="countdown-overlay"
            class="absolute inset-0 flex items-center justify-center z-50 pointer-events-none hidden">
            <div id="countdown-text" class="text-9xl font-black text-yellow-400 italic">
                3
            </div>
        </div>

        <!-- Rank Panel (Top Right) -->
        <div id="rank-panel"
            class="hidden absolute top-20 right-4 bg-black/60 backdrop-blur-md p-3 rounded-xl text-white w-56 z-20 border border-white/10 shadow-xl">
            <div class="flex justify-between items-center mb-2 border-b border-white/20 pb-1">
                <h3 class="text-xs font-bold text-gray-300 uppercase tracking-wider">
                    Live Ranking
                </h3>
                <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
            </div>
            <ul id="rank-list" class="space-y-1"></ul>
        </div>

        <!-- Commentary Box -->
        <div id="commentary-box">
            <span class="commentary-label">LIVE</span>
            <span id="commentary-text">„É¨„Éº„ÇπÈñãÂßã„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô...</span>
        </div>

        <!-- Cut-in Overlay -->
        <div id="cut-in-overlay">
            <div class="speed-lines"></div>
            <div class="cut-in-content">
                <div id="cut-in-horse" class="text-6xl">üê¥</div>
                <div class="flex flex-col">
                    <span id="cut-in-name" class="cut-in-horse-name">Horse Name</span>
                    <span id="cut-in-skill" class="cut-in-text">SKILL NAME!</span>
                </div>
            </div>
        </div>

        <!-- Header -->
        <div class="p-6 flex justify-between items-start glass-header w-full absolute top-0 z-10 pointer-events-none">
            <div class="glass-panel px-6 py-3 rounded-lg flex items-center gap-4 transform skew-x-[-10deg]">
                <h1 class="text-2xl font-tech font-bold text-white italic tracking-wider skew-x-[10deg]">
                    TOY DERBY <span class="text-gold-500 text-sm">GP</span>
                </h1>
                <div class="h-6 w-px bg-white/20 skew-x-[10deg]"></div>
                <div id="course-name-display"
                    class="text-sm font-display text-white skew-x-[10deg] tracking-wide text-shadow-sm uppercase">
                    LOADING
                </div>
                <div class="h-6 w-px bg-white/20 skew-x-[10deg]"></div>
                <div class="flex items-center gap-2 skew-x-[10deg]">
                    <div class="text-gold-400 text-xs">CREDITS</div>
                    <span id="wallet-display"
                        class="font-display font-bold text-gold-glow text-2xl tracking-widest text-shadow-glow">1000</span>
                    <span class="text-xs text-gray-400">G</span>
                </div>
            </div>

            <button id="camera-btn"
                class="interactive hidden btn-neon rounded-lg w-12 h-12 flex items-center justify-center text-xl shadow-lg"
                onclick="toggleCamera()">
                üì∑
            </button>
        </div>

        <!-- Speed Lines Overlay -->
        <div id="speed-lines" class="speed-lines"></div>

        <!-- GP Overlay Info -->
        <div id="gp-info-overlay" class="hidden absolute top-24 left-6 z-20">
            <div class="glass-panel px-4 py-2 rounded-lg flex flex-col gap-1 items-start">
                <div class="flex items-center gap-2">
                    <span class="gp-badge">GP MODE</span>
                    <span class="text-white font-display text-lg">ROUND <span id="gp-round-display"
                            class="text-yellow-400">1</span>/5</span>
                </div>
                <div id="gp-relics-list" class="flex gap-1 mt-1">
                    <!-- Icons injected here -->
                </div>
            </div>
        </div>

        <!-- Upgrade / Relic Selection Panel -->
        <div id="upgrade-panel"
            class="hidden interactive absolute inset-0 flex items-center justify-center z-40 bg-black/80 backdrop-blur-sm">
            <div class="glass-panel p-8 rounded-xl shadow-2xl max-w-4xl w-full mx-4 flex flex-col items-center">
                <h2 class="text-3xl font-display font-bold text-white mb-2">RACE COMPLETED!</h2>
                <p class="text-gray-300 font-tech mb-8">Choose an upgrade for the next round</p>

                <div id="upgrade-cards" class="grid grid-cols-3 gap-6 w-full mb-8">
                    <!-- Cards injected by JS -->
                </div>

                <div class="text-center">
                    <div class="text-sm text-gray-400 mb-2">NEXT RACE FORECAST</div>
                    <div id="next-race-info" class="text-xl text-white font-bold font-display">
                        ‚òÄÔ∏è Sunny / Track: Normal
                    </div>
                </div>
            </div>
        </div>

        <!-- Center: Results -->
        <div id="center-panel" class="absolute inset-0 flex items-center justify-center pointer-events-none z-30">
            <div id="result-modal"
                class="hidden interactive glass-panel border border-gold-500/30 p-8 rounded-xl shadow-xl max-w-sm w-full text-center transform scale-95 opacity-0 transition-all duration-300">
                <div class="text-6xl mb-4 filter drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">
                    üèÅ
                </div>
                <h2 class="text-4xl font-display font-bold mb-2 text-white italic tracking-tighter">
                    FINISH!
                </h2>
                <div id="result-message" class="text-lg mb-6 font-tech text-gray-300 tracking-wide">
                    ...
                </div>

                <div class="bg-black/40 rounded-lg p-4 mb-8 border border-white/5">
                    <div class="text-xs text-gray-500 uppercase font-bold tracking-widest mb-1">
                        TOTAL PAYOUT
                    </div>
                    <div id="payout-display" class="text-5xl font-display font-bold text-gold-glow drop-shadow-md">
                        0 G
                    </div>
                </div>

                <button onclick="resetGame()"
                    class="w-full btn-neon py-4 text-xl font-bold rounded shadow-lg transition transform hover:scale-[1.02] tracking-wider">
                    NEXT RACE
                </button>
            </div>
        </div>

        <!-- Footer: Betting -->
        <div id="betting-panel"
            class="interactive absolute inset-0 flex items-center justify-center z-20 transition-all duration-500 ease-in-out bg-black/50 backdrop-blur-sm">
            <div
                class="glass-panel p-8 rounded-xl shadow-2xl max-w-6xl w-full mx-4 transform transition-all duration-500">
                <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                    <h3 class="text-white font-tech font-bold text-3xl tracking-widest border-l-4 border-gold-500 pl-4">
                        SELECT HORSE
                    </h3>
                    <div
                        class="bg-black/40 px-6 py-2 rounded-lg text-sm text-gray-300 font-tech flex items-center gap-3 border border-white/5">
                        <span>BET AMOUNT</span>
                        <span class="font-display font-bold text-gold-400 text-2xl">100 G</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleGPMode()" id="gp-toggle-btn"
                            class="px-4 py-2 rounded bg-gray-800 border border-gray-600 hover:bg-gray-700 transition font-tech text-gray-300">
                            <span class="opacity-50">üèÜ GP MODE: OFF</span>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-5 gap-4" id="horse-selector">
                    <!-- Cards generated by JS -->
                </div>

                <div class="mt-8 flex justify-center">
                    <button id="start-btn" onclick="handleStartButton()" disabled
                        class="btn-neon py-4 px-24 text-2xl font-bold rounded skew-x-[-15deg] shadow-[0_0_30px_rgba(245,158,11,0.3)] opacity-50 cursor-not-allowed transition-all hover:scale-105 active:scale-95">
                        <span id="start-btn-text" class="block skew-x-[15deg] tracking-[0.2em]">START RACE</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Entry Point -->
    <script type="module" src="js/main.js"></script>
</body>

</html>